from pymongo import MongoClient
import json
import os

# MongoDB URI and Database Names
MONGODB_URI = "mongodb+srv://Admin:Admin@recommendation-cluster.mza82o4.mongodb.net/?retryWrites=true&w=majority&appName=recommendation-cluster"
DATABASE_NAME = "animeDB"
ANIME_COLLECTION_NAME = "anime_granular_embedding"  # Define your collection name

# Connect to MongoDB
client = MongoClient(MONGODB_URI)
db = client[DATABASE_NAME]
anime_collection = db[ANIME_COLLECTION_NAME]

# Load the anime data that contains the 'title' fields
with open("C:/Users/berka/Masters/TNM108/project/anime-recommendation/backend/data/anime_data.json", "r") as f:
    anime_data = json.load(f)

# Ensure the data list is not empty
if not anime_data:
    raise ValueError("No anime data found in 'anime_data.json'.")

# Clear existing collection to prevent duplicates
anime_collection.delete_many({})

# Insert data into MongoDB
for idx, anime in enumerate(anime_data):
    # Retrieve the title from 'anime_data'
    title = (anime.get("English") or
             anime.get("Japanese") or
             anime.get("Synonyms") or
             "")
    
    if not title:
        print(f"Warning: Missing 'title' for anime at index {idx}.")
        continue  # Skip this anime due to missing title

    # Prepare the document to insert
    anime_doc = {
        "anime_id": idx,
        "title": title,
        "Description": anime.get("Description", ""),
        "Genres": anime.get("Genres", ""),
        "Demographic": anime.get("Demographic", ""),
        "Rating": anime.get("Rating", ""),
        # Include other necessary fields as needed
    }
    anime_collection.insert_one(anime_doc)

print(f"Inserted documents into '{ANIME_COLLECTION_NAME}' collection.")

client.close()
