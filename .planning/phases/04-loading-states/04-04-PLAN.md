---
phase: 04-loading-states
plan: 04
type: execute
wave: 2
depends_on: [04-01, 04-02, 04-03]
files_modified:
  - frontend/components/loading/ProgressBar.tsx
  - frontend/hooks/useProgress.ts
  - frontend/app/page.tsx
autonomous: false

must_haves:
  truths:
    - "Progress bar displays during recommendation generation"
    - "Progress bar shows current step message to user"
    - "User can cancel recommendation generation with Cancel button"
  artifacts:
    - path: "frontend/components/loading/ProgressBar.tsx"
      provides: "Progress bar with messaging and cancel button"
      exports: ["ProgressBar"]
    - path: "frontend/hooks/useProgress.ts"
      provides: "Progress state management hook"
      exports: ["useProgress"]
    - path: "frontend/app/page.tsx"
      provides: "Home page with progress integration"
  key_links:
    - from: "ProgressBar component"
      to: "@radix-ui/react-progress"
      via: "Progress component import"
      pattern: 'from "@/components/ui/progress"'
    - from: "frontend/app/page.tsx"
      to: "frontend/hooks/useProgress.ts"
      via: "useProgress hook import"
      pattern: "import.*useProgress"
---

<objective>
Add progress indicators for long-running recommendation generation

Purpose: Provide users with feedback during multi-step recommendation generation with ability to cancel
Output: ProgressBar component with messaging, useProgress hook, and integration into home page
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/STATE.md
@.planning/ROADMAP.md
@.planning/phases/04-loading-states/04-RESEARCH.md

@frontend/components/ui/progress.tsx
@frontend/hooks/useRecommendations.ts
@frontend/app/page.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create ProgressBar component</name>
  <files>frontend/components/loading/ProgressBar.tsx</files>
  <action>
    Create frontend/components/loading/ProgressBar.tsx:

    Implement component with:
    1. Import Progress from @/components/ui/progress
    2. Import Button from @/components/ui/button
    3. Import X from lucide-react for cancel icon
    4. Props interface:
       - progress?: number (undefined = indeterminate mode)
       - message: string (current step description)
       - onCancel?: () => void (optional cancel handler)
    5. Layout: vertical stack (space-y-2) with Progress, message text, and optional cancel button
    6. ARIA attributes: role="status", aria-live="polite", aria-busy={progress === undefined}
    7. Cancel button: ghost variant, small size, X icon with "Cancel" text

    Reference: Code Example from RESEARCH.md (Progress Bar with Messaging)

    Progress component from Radix UI already has built-in accessibility
  </action>
  <verify>
    Component file exists and exports ProgressBar:
    grep -q "export.*ProgressBar" frontend/components/loading/ProgressBar.tsx && echo "Component exported"
  </verify>
  <done>
    ProgressBar component created with indeterminate/determinate modes and cancel button
  </done>
</task>

<task type="auto">
  <name>Task 2: Create useProgress hook</name>
  <files>frontend/hooks/useProgress.ts</files>
  <action>
    Create frontend/hooks/useProgress.ts:

    Implement custom hook that:
    1. Manages progress state (0-100 or undefined for indeterminate)
    2. Manages current step message
    3. Manages isGenerating flag
    4. Provides functions: startProgress, updateProgress, setStep, finishProgress, cancel
    5. Returns: { progress, message, isGenerating, startProgress, updateProgress, setStep, finishProgress, cancel }

    Steps pattern for recommendations:
    - 0-30%: "Fetching anime data..."
    - 30-70%: "Generating recommendations..."
    - 70-100%: "Preparing results..."

    Use useState for state management
    No useEffect needed (this is controlled by caller)

    This hook provides step-based progress tracking for long-running operations
  </action>
  <verify>
    Hook file exists and exports useProgress:
    grep -q "export.*useProgress" frontend/hooks/useProgress.ts && echo "Hook exported"
  </verify>
  <done>
    useProgress hook created for tracking multi-step operations
  </done>
</task>

<task type="auto">
  <name>Task 3: Integrate progress into home page</name>
  <files>frontend/app/page.tsx</files>
  <action>
    Update frontend/app/page.tsx to use progress tracking:

    1. Read the current file to understand structure
    2. Import useProgress hook and ProgressBar component
    3. Add progress state where recommendations are generated
    4. Update progress during recommendation generation steps
    5. Render ProgressBar when isGenerating is true

    Look for recommendation generation logic (likely in useRecommendations hook or similar)
    Wire progress updates into the recommendation flow

    If recommendation generation happens in Web Worker (useRecommendations.ts):
    - Use indeterminate progress (undefined) since Web Worker progress is complex
    - Update message based on worker state changes
    - Show cancel button that aborts the worker

    Reference: useRecommendations.ts which uses Web Worker for embedding calculations
  </action>
  <verify>
    Progress tracking integrated:
    grep -q "useProgress\|ProgressBar" frontend/app/page.tsx && echo "Progress integration found"
  </verify>
  <done>
    Home page shows progress bar during recommendation generation with cancel button
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Complete progress indicator system for recommendation generation</what-built>
  <how-to-verify>
    1. Start frontend: cd frontend && npm run dev
    2. Open http://localhost:3000
    3. Select 3+ anime on home page
    4. Click "Get Recommendations"
    5. Verify progress bar appears with message
    6. Verify progress updates during generation
    7. Verify Cancel button appears and works
    8. Verify loading state disappears when complete
  </how-to-verify>
  <resume-signal>Type "approved" if progress indicator works smoothly, or describe issues</resume-signal>
</task>

</tasks>

<verification>
1. ProgressBar component displays with indeterminate or determinate progress
2. Progress message updates to show current step
3. Cancel button appears and stops recommendation generation
4. Home page integrates progress tracking during recommendations
5. Progress bar disappears when recommendations complete
6. ARIA attributes announce progress to screen readers
</verification>

<success_criteria>
1. ProgressBar component created with optional cancel button
2. useProgress hook manages step-based progress tracking
3. Home page shows progress during recommendation generation
4. Users can cancel in-progress recommendation generation
5. Progress messages clearly communicate current step
6. Zero TypeScript errors
7. Manual verification passes - user approves progress UX
</success_criteria>

<output>
After completion, create `.planning/phases/04-loading-states/04-04-SUMMARY.md`
</output>
