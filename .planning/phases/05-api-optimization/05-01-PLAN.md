---
phase: 05-api-optimization
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - frontend/app/providers.tsx
  - frontend/app/layout.tsx
  - frontend/package.json
autonomous: true

must_haves:
  truths:
    - "Application renders without errors after wrapping with QueryClientProvider"
    - "React Query DevTools visible in development mode"
    - "QueryClient configured with appropriate defaults (staleTime, gcTime, retry)"
    - "All existing functionality still works (no breaking changes)"
  artifacts:
    - path: "frontend/app/providers.tsx"
      provides: "QueryClientProvider setup with React Query DevTools"
      min_lines: 40
      exports: ["Providers"]
    - path: "frontend/package.json"
      provides: "React Query dependencies"
      contains: "@tanstack/react-query"
    - path: "frontend/app/layout.tsx"
      provides: "Root layout with Providers wrapper"
      contains: "<Providers>"
  key_links:
    - from: "frontend/app/layout.tsx"
      to: "frontend/app/providers.tsx"
      via: "Providers import"
      pattern: "import.*Providers.*from.*providers"
---

<objective>
Set up React Query infrastructure with QueryClient provider and DevTools integration

Purpose: Establish foundation for React Query adoption across the application
Output: Working QueryClientProvider with configured defaults and DevTools
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md

@.planning/phases/05-api-optimization/05-RESEARCH.md
@.planning/phases/05-api-optimization/05-CONTEXT.md
</execution_context>

<context>
@.planning/STATE.md
@.planning/ROADMAP.md
@.planning/REQUIREMENTS.md
</context>

<tasks>

<task type="auto">
  <name>Install React Query dependencies</name>
  <files>frontend/package.json</files>
  <action>
    Install TanStack Query v5 and DevTools:
    ```bash
    cd frontend && npm install @tanstack/react-query @tanstack/react-query-devtools
    ```

    Do NOT install @tanstack/react-query-next-experimental (experimental package not production-ready)
  </action>
  <verify>grep -q "@tanstack/react-query" frontend/package.json && grep -q "@tanstack/react-query-devtools" frontend/package.json</verify>
  <done>@tanstack/react-query and @tanstack/react-query-devtools packages installed</done>
</task>

<task type="auto">
  <name>Create QueryClient provider</name>
  <files>frontend/app/providers.tsx</files>
  <action>
    Create new providers.tsx file with QueryClient setup:

    ```typescript
    'use client'

    import { QueryClient, QueryClientProvider } from '@tanstack/react-query'
    import { ReactQueryDevtools } from '@tanstack/react-query-devtools'
    import { useState } from 'react'
    import { logger } from '@/lib/logger'

    export function Providers({ children }: { children: React.ReactNode }) {
      const [queryClient] = useState(() => {
        const client = new QueryClient({
          defaultOptions: {
            queries: {
              staleTime: 60 * 1000, // 1 minute default
              gcTime: 5 * 60 * 1000, // 5 minutes cache retention
              refetchOnWindowFocus: false,
              retry: (failureCount, error) => {
                // Log retries
                if (failureCount > 0) {
                  logger.warn({ error, failureCount }, 'Query retrying')
                }
                return failureCount < 2 // Max 2 retries
              },
            },
          },
        })

        // Enable query logging in development
        if (process.env.NODE_ENV === 'development') {
          const queryCache = client.getQueryCache()
          queryCache.subscribe({
            onQueryAdded: (query) => {
              logger.debug({ queryKey: query.queryKey }, 'Query added')
            },
          })
        }

        return client
      })

      return (
        <QueryClientProvider client={queryClient}>
          {children}
          <ReactQueryDevtools initialIsOpen={false} position="bottom-right" />
        </QueryClientProvider>
      )
    }
    ```

    Reference: RESEARCH.md "Example 1: Setting up React Query with Next.js 15"
  </action>
  <verify>test -f frontend/app/providers.tsx && grep -q "QueryClientProvider" frontend/app/providers.tsx</verify>
  <done>providers.tsx created with QueryClient setup, default options, and DevTools</done>
</task>

<task type="auto">
  <name>Integrate Providers into root layout</name>
  <files>frontend/app/layout.tsx</files>
  <action>
    Modify existing layout.tsx to wrap children with Providers component:

    1. Import Providers at top of file:
       ```typescript
       import { Providers } from './providers'
       ```

    2. Wrap children with Providers component in the body:
       ```typescript
       <body>
         <Providers>{children}</Providers>
       </body>
       ```

    Do NOT modify any other parts of the layout (theme provider, clerk provider, etc.)
  </action>
  <verify>grep -q "import.*Providers.*from.*providers" frontend/app/layout.tsx && grep -q "<Providers>" frontend/app/layout.tsx</verify>
  <done>Root layout updated to wrap application with QueryClientProvider</done>
</task>

</tasks>

<verification>
1. Start development server: `cd frontend && npm run dev`
2. Verify no TypeScript errors: `npm run lint` (should pass with no new errors)
3. Verify application loads in browser at http://localhost:3000
4. Open React Query DevTools (bottom-right icon) - should show query panel
5. Check browser console for errors - should be clean
</verification>

<success_criteria>
1. Application renders without errors after React Query integration
2. React Query DevTools accessible in development mode
3. QueryClient configured with appropriate defaults (1min staleTime, 5min gcTime, max 2 retries)
4. No TypeScript or ESLint errors introduced
5. All existing pages and components still function correctly
</success_criteria>

<output>
After completion, create `.planning/phases/05-api-optimization/05-01-SUMMARY.md`
</output>
